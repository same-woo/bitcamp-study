<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.myapp.dao.BoardDao">

<resultMap type="bitcamp.myapp.vo.Board" id="boardMap">
  <id     column="board_no"       property="no"/>
  <result column="title"          property="title"/>
  <result column="content"        property="content"/>
  <result column="view_count"     property="viewCount"/>
  <result column="created_date"   property="createdDate"/>
  <result column="animal_no"       property="animalNo"/>
  <result column="category"       property="categoryNo"/>
  
  <association property="writer" javaType="bitcamp.myapp.vo.Member">
    <id     column="writer"    property="no"/>
    <result column="writerName" property="name"/>
  </association>
</resultMap>

  <!-- Insert Query -->
  <insert id="insert" parameterType="bitcamp.myapp.vo.Board">
    INSERT INTO myapp_board(title, content, writer, created_date, animal_no, category)
    VALUES (#{title}, #{content}, #{writer.no}, #{createdDate}, #{animalNo}, #{categoryNo})
  </insert>
  
  <!-- Select All Query -->
  <select id="findAll" resultMap="boardMap">
    SELECT
      g.board_no,
      g.title,
      g.view_count,
      g.created_date,
      g.animal_no,
      g.category,
      m.member_no as writer,
      m.name as writerName
    FROM
      myapp_board g INNER JOIN myapp_member m ON g.writer=m.member_no
    where
	  category=#{categoryNo}
    ORDER BY
      board_no DESC
  </select>
  
  <!-- Select by Board Number Query -->
  <select id="findBy" parameterType="int" resultMap="boardMap">
    SELECT
      g.board_no,
      g.title,
      g.content,
      g.view_count,
      g.created_date,
      g.animal_no,
      g.category,
      m.member_no as writer,
      m.name as writerName
    FROM
      myapp_board g INNER JOIN myapp_member m ON g.writer=m.member_no
    WHERE
      g.category = #{categoryNo}
      AND g.board_no = #{boardNo}
  </select>
  
  <!-- Update Query -->
  <update id="update" parameterType="bitcamp.myapp.vo.Board">
    UPDATE myapp_board SET
      title = #{title},
      content = #{content}
    WHERE 
      board_no = #{no}
      AND writer = #{writer.no}
  </update>
  
  <!-- Update View Count Query -->
  <update id="updateCount" parameterType="bitcamp.myapp.vo.Board">
    UPDATE myapp_board SET
      view_count = #{viewCount}
    WHERE
      board_no = #{no}
  </update>
  
  <!-- Delete Query -->
  <delete id="delete" parameterType="bitcamp.myapp.vo.Board">
    DELETE FROM myapp_board
    WHERE 
      board_no = #{no}
      AND writer = #{writer.no}
  </delete>
  
  <!-- Delete All by Member Number Query -->
  <delete id="deleteAllByMemberNo" parameterType="int">
    DELETE FROM myapp_board
    WHERE 
      writer = #{memberNo}
  </delete>
  
</mapper>
